<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
  <script src="https://unpkg.com/vue/dist/vue.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
  <style>
body {
  -webkit-font-size-adjust: 100%;
  font: 14px 'Helvetica Neue', Helvetica, Arial, sans-serif;
}
#main span { font-size: 50pt; font-weight: bold }
#main {
  margin:auto;
  text-align:center;
}
span#answer { color: red }
.parent{
  width: 100%;
  height:95%;
  border: 1px solid #aaa;
  padding: 1px;
  margin: auto;
  position: relative;
  text-align: center;
}
@media screen and (orientation:portrait) {
  /* 縦向き */
  #question-area{
    width: 100%;
    height: 130px;
    float: left;
  }
  #answer-area{
    margin:auto;
    width: 100%;
    clear: float;
    text-align:center;
  }
}
@media screen and (orientation:landscape) {
  /* 横向き */
  #question-area{
    width: 50%;
    height: 100%;
    float: left;
    padding-right: 20px;
    text-align: right;
  }
  #answer-area{
    width: 40%;
    height:100%;
    float: right;
    padding-left: 20px;
    text-align: left;
  }
}

</style>
</head>
<body>
<div id="main">
  <div class="parent">
    <div>
      <h1 style="font-size:24px">算数クイズ</h1>
      <button id="initialize" v-on:click="initialize">最初から</button><br>
      <input id="plus"  type="radio" value="plus"  v-model="current" v-on:change="prepare" :checked="true"><label for="plus">足し算</label>
      <input id="minus" type="radio" value="minus" v-model="current" v-on:change="prepare">                <label for="minus">引き算</label>
      <input id="multiply" type="radio" value="multiply" v-model="current" v-on:change="prepare">          <label for="multiply">かけ算</label>
    </div>
    <div>
      <h2>第 {{step}} 問</h2>
    </div>
    <div style="margin-top:10px;height:80%" v-on:click="nextStep">
      <div id="question-area">
        <span id="n1">{{ n1 }}</span>
        <span id="sign">{{ rule[current].sign_display }}</span>
        <span id="n2">{{ n2 }}</span>
        <span id="eq">=</span>
      </div>
      <div id="answer-area">
        <span id="answer">{{ ans }}</span>
      </div>
    </div>
  </div>
</div>
</body>
<script>
var vue = new Vue({
  el: '#main',
  data: {
    step: 1,
    n1: 0,
    n2: 0,
    current: 'plus',
    ans: '',
    rule: {
      plus:     { min: 10, max: 99, sign: '+', sign_display: '+'  },
      minus:    { min: 10, max: 99, sign: '-', sign_display: '-'  },
      multiply: { min: 1,  max: 9,  sign: '*', sign_display: '×' }
    }
  },
  methods: {
    initialize: function() {
      this.step = 1;
      this.ans = ''
      this.prepare();
    },
    prepare: function() {
      if (this.ans !== '') {
        this.step += 1;
      }
      var current_rule = this.rule[this.current];
      this.n1 = _.random(current_rule.min, current_rule.max);
      // 引き算の場合は、a - b の場合、a >= b でないといけないため、
      // a が小さい値の場合は、a = b となってしまう確率が高くなる
      var max = (this.current === 'minus') ? this.n1 : current_rule.max;
      this.n2 = _.random(current_rule.min, max);
      if (this.current === 'minus' && this.n1 === this.n2) {
        this.n2 = _.random(current_rule.min, max); // できるだけ同値の引き算(=0)を避けるため1度だけリトライする
      }
      this.ans = ''
    },
    answer: function() {
      this.ans = eval(this.n1 + this.rule[this.current].sign + this.n2);
    },
    nextStep: function() {
      if (event.keyCode !== 13) return;
      if (this.ans === '') this.answer();
      else                 this.prepare();
    }
  },
  created() {
    document.addEventListener('keydown', this.nextStep);
  }
});
vue.prepare();
</script>
</html>
